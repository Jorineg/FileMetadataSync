services:
  file-metadata-sync:
    build: .
    container_name: file-metadata-sync
    env_file:
      - .env
    environment:
      # PostgREST API (database operations)
      - POSTGREST_URL=${POSTGREST_URL}
      - FMS_SERVICE_SECRET=${FMS_SERVICE_SECRET}
      # Supabase Storage (S3 uploads only)
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
      - S3_BUCKET=${S3_BUCKET:-files}
      # Sync settings
      - SYNC_WORKERS=${SYNC_WORKERS:-6}
      - DEBOUNCE_SECONDS=${DEBOUNCE_SECONDS:-3.0}
      - IGNORE_PATTERNS=${IGNORE_PATTERNS:-}
      - FULL_SCAN_HOUR=${FULL_SCAN_HOUR:-3}
      - FULL_SCAN_ON_STARTUP=${FULL_SCAN_ON_STARTUP:-true}
      # Logging
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - BETTERSTACK_SOURCE_TOKEN=${BETTERSTACK_SOURCE_TOKEN}
      - BETTERSTACK_INGEST_HOST=${BETTERSTACK_INGEST_HOST}
      - TIMEZONE=${TIMEZONE:-Europe/Berlin}
    volumes:
      # Mount your directories to /data - everything under /data is scanned
      # Examples:
      #   - /volume1/documents:/data/documents:ro
      #   - /volume1/images:/data/images:ro
      # Or mount a single parent:
      #   - /volume1/files:/data:ro
      - /volume1/dashboard123:/data/dashboard123:ro
    restart: unless-stopped
