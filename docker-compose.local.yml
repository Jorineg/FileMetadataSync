services:
  file-metadata-sync:
    build: .
    container_name: file-metadata-sync-local
    env_file:
      - .env
    environment:
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
      - S3_BUCKET=${S3_BUCKET:-files}
      - SYNC_WORKERS=${SYNC_WORKERS:-4}
      - DEBOUNCE_SECONDS=${DEBOUNCE_SECONDS:-2.0}
      - IGNORE_PATTERNS=${IGNORE_PATTERNS:-}
      - FULL_SCAN_HOUR=${FULL_SCAN_HOUR:-3}
      - FULL_SCAN_ON_STARTUP=${FULL_SCAN_ON_STARTUP:-true}
      - LOG_LEVEL=${LOG_LEVEL:-DEBUG}
      - BETTERSTACK_SOURCE_TOKEN=${BETTERSTACK_SOURCE_TOKEN}
      - BETTERSTACK_INGEST_HOST=${BETTERSTACK_INGEST_HOST}
      - TIMEZONE=${TIMEZONE:-Europe/Berlin}
    volumes:
      # Mount test_data to /data - auto-scanned
      - ./test_data:/data:ro
      - ./logs:/app/logs
    restart: unless-stopped
